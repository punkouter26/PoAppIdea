@using PoAppIdea.Core.Enums
@using PoAppIdea.Web.Features.Gallery

<div class="glass-card gallery-card h-100 rz-p-4 animate-scale-in">
    <!-- Header with App Type Badge -->
    <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.SpaceBetween" AlignItems="AlignItems.Start">
        <RadzenBadge BadgeStyle="@GetAppTypeBadgeStyle(Item.AppType)" Text="@Item.AppType.ToString()" Variant="Variant.Flat" />
        <RadzenBadge BadgeStyle="BadgeStyle.Info" Text="@Item.ArtifactType.ToString()" Variant="Variant.Outlined" />
    </RadzenStack>

    <!-- Title and Description -->
    <RadzenStack Gap="0.5rem" Style="flex: 1; margin-top: 1rem;">
        <RadzenText TextStyle="TextStyle.H6" class="rz-m-0 rz-line-height-2" Style="color: var(--rz-primary);">
            @Item.Title
        </RadzenText>
        <RadzenText TextStyle="TextStyle.Body2" class="rz-text-secondary-color" Style="display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden;">
            @(string.IsNullOrEmpty(Item.Description) ? "No description available" : Item.Description)
        </RadzenText>
    </RadzenStack>

    <div class="card-footer rz-mt-4">
        <!-- Author Row -->
        <RadzenStack Orientation="Orientation.Horizontal" Gap="0.5rem" AlignItems="AlignItems.Center">
            <RadzenIcon Icon="person" Style="font-size: 1rem; color: var(--rz-text-tertiary-color);" />
            <RadzenText TextStyle="TextStyle.Caption" class="rz-text-tertiary-color">
                @Item.AuthorDisplayName â€¢ @GetTimeAgo(Item.PublishedAt.DateTime)
            </RadzenText>
        </RadzenStack>

        <!-- Action Buttons -->
        <RadzenStack Orientation="Orientation.Horizontal" Gap="0.5rem" class="rz-mt-4" JustifyContent="JustifyContent.End">
            <RadzenButton Icon="visibility" ButtonStyle="ButtonStyle.Light" Size="ButtonSize.Small" Variant="Variant.Text"
                Click="@(() => OnView.InvokeAsync(Item))" Tooltip="View Details" />
            <RadzenButton Text="Import" Icon="download" ButtonStyle="ButtonStyle.Primary" Size="ButtonSize.Medium"
                Click="@(() => OnImport.InvokeAsync(Item))" />
        </RadzenStack>
    </div>
</div>

@code {
    [Parameter, EditorRequired]
    public GalleryItemDto Item { get; set; } = default!;

    [Parameter]
    public EventCallback<GalleryItemDto> OnView { get; set; }

    [Parameter]
    public EventCallback<GalleryItemDto> OnImport { get; set; }

    private BadgeStyle GetAppTypeBadgeStyle(AppType appType) => appType switch
    {
        AppType.WebApp => BadgeStyle.Primary,
        AppType.MobileApp => BadgeStyle.Success,
        AppType.ConsoleApp => BadgeStyle.Warning,
        AppType.UnityApp => BadgeStyle.Info,
        _ => BadgeStyle.Light
    };

    private string GetTimeAgo(DateTime dateTime)
    {
        var span = DateTime.UtcNow - dateTime;
        
        if (span.TotalDays >= 365)
            return $"{(int)(span.TotalDays / 365)}y ago";
        if (span.TotalDays >= 30)
            return $"{(int)(span.TotalDays / 30)}mo ago";
        if (span.TotalDays >= 1)
            return $"{(int)span.TotalDays}d ago";
        if (span.TotalHours >= 1)
            return $"{(int)span.TotalHours}h ago";
        if (span.TotalMinutes >= 1)
            return $"{(int)span.TotalMinutes}m ago";
        
        return "just now";
    }
}

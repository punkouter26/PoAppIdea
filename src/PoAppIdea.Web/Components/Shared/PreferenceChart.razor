@using Radzen
@using Radzen.Blazor

<div class="preference-chart @GetStrengthClass()">
    <div class="chart-content">
        <div class="chart-ring">
            <svg viewBox="0 0 36 36">
                <path class="ring-background"
                      d="M18 2.0845
                        a 15.9155 15.9155 0 0 1 0 31.831
                        a 15.9155 15.9155 0 0 1 0 -31.831"
                      fill="none"
                      stroke="var(--rz-base-200)"
                      stroke-width="3"/>
                <path class="ring-progress"
                      d="M18 2.0845
                        a 15.9155 15.9155 0 0 1 0 31.831
                        a 15.9155 15.9155 0 0 1 0 -31.831"
                      fill="none"
                      stroke="@GetStrokeColor()"
                      stroke-width="3"
                      stroke-dasharray="@GetDashArray()"
                      stroke-linecap="round"/>
            </svg>
            <div class="chart-value">@GetStrengthPercent()%</div>
        </div>
        <div class="chart-info">
            <span class="chart-theme">@Theme</span>
            <span class="chart-category">@Category</span>
        </div>
    </div>
</div>

@code {
    /// <summary>
    /// The preference theme name.
    /// </summary>
    [Parameter]
    public string Theme { get; set; } = "";

    /// <summary>
    /// The strength of the preference (-1.0 to 1.0).
    /// </summary>
    [Parameter]
    public float Strength { get; set; }

    /// <summary>
    /// The category (Product or Technical).
    /// </summary>
    [Parameter]
    public string Category { get; set; } = "";

    private string GetStrengthClass()
    {
        return Strength switch
        {
            >= 0.6f => "strong",
            >= 0.3f => "moderate",
            >= 0 => "weak",
            _ => "negative"
        };
    }

    private string GetStrokeColor()
    {
        return Strength switch
        {
            >= 0.6f => "#4CAF50",
            >= 0.3f => "#2196F3",
            >= 0 => "#9E9E9E",
            _ => "#f44336"
        };
    }

    private int GetStrengthPercent()
    {
        return (int)(Math.Abs(Strength) * 100);
    }

    private string GetDashArray()
    {
        var percent = Math.Abs(Strength) * 100;
        return $"{percent}, 100";
    }
}

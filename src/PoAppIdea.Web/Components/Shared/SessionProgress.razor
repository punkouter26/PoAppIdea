@using PoAppIdea.Core.Enums

<div class="session-progress-container" style="margin: var(--space-xl) 0;">
    <div class="progress-steps">
        @foreach (var step in _steps)
        {
            var stepClass = GetStepClass(step.Phase);
            <div class="progress-step @stepClass" title="@step.Label">
                <div class="progress-step-circle">
                    @if (IsCompleted(step.Phase))
                    {
                        <span style="font-size: 0.875rem;">&#x2713;</span>
                    }
                    else
                    {
                        <span>@step.Number</span>
                    }
                </div>
                <span class="progress-step-label">@step.Label</span>
            </div>
            @if (step.Number < 6)
            {
                <div class="step-connector" style="flex: 1; height: 2px; background: @(IsCompleted(step.Phase) ? "var(--app-primary)" : "var(--border-color)"); margin-top: 20px; transition: background var(--transition-slow);"></div>
            }
        }
    </div>
</div>

@code {
    [Parameter]
    public SessionPhase CurrentPhase { get; set; }

    [Parameter]
    public Guid? SessionId { get; set; }

    private record StepInfo(int Number, string Label, SessionPhase Phase);

    private readonly List<StepInfo> _steps =
    [
        new(1, "Spark", SessionPhase.Phase1_Spark),
        new(2, "Evolve", SessionPhase.Phase2_Mutation),
        new(3, "Features", SessionPhase.Phase3_FeatureExpansion),
        new(4, "Submit", SessionPhase.Submission),
        new(5, "Refine", SessionPhase.Phase4_ProductRefinement),
        new(6, "Artifacts", SessionPhase.Phase6_Visual)
    ];

    private string GetStepClass(SessionPhase phase)
    {
        if (phase == CurrentPhase) return "active";
        if (IsCompleted(phase)) return "completed";
        return "pending";
    }

    private bool IsCompleted(SessionPhase phase) => (int)phase < (int)CurrentPhase;
}

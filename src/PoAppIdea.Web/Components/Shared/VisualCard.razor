@using PoAppIdea.Web.Features.Visual
@using Radzen
@using Radzen.Blazor

<div class="visual-card @(IsSelected ? "selected" : "")" @onclick="HandleClick">
    <div class="card-image">
        <img src="@Asset.ThumbnailUrl" alt="Visual mockup" loading="lazy" />
        @if (IsSelected)
        {
            <div class="selected-badge">
                <RadzenIcon Icon="check_circle" />
            </div>
        }
    </div>

    <div class="card-content">
        <div class="style-attributes">
            <div class="attribute">
                <span class="label">Layout:</span>
                <span class="value">@Asset.StyleAttributes.LayoutStyle</span>
            </div>
            <div class="attribute">
                <span class="label">Vibe:</span>
                <span class="value">@Asset.StyleAttributes.Vibe</span>
            </div>
        </div>

        <div class="color-palette">
            @foreach (var color in Asset.StyleAttributes.ColorPalette.Take(5))
            {
                <div class="color-swatch" style="background-color: @color" title="@color"></div>
            }
        </div>

        <RadzenButton Text="@(IsSelected ? "Selected" : "Select This Style")"
                      Icon="@(IsSelected ? "check" : "touch_app")"
                      ButtonStyle="@(IsSelected ? ButtonStyle.Success : ButtonStyle.Secondary)"
                      Size="ButtonSize.Small"
                      class="select-button"
                      Click="@HandleClick"
                      Click:stopPropagation="true" />
    </div>
</div>

@code {
    /// <summary>
    /// The visual asset to display.
    /// </summary>
    [Parameter]
    public required VisualAssetDto Asset { get; set; }

    /// <summary>
    /// Whether this visual is currently selected.
    /// </summary>
    [Parameter]
    public bool IsSelected { get; set; }

    /// <summary>
    /// Callback when the visual is selected.
    /// </summary>
    [Parameter]
    public EventCallback OnSelect { get; set; }

    private async Task HandleClick()
    {
        if (!IsSelected && OnSelect.HasDelegate)
        {
            await OnSelect.InvokeAsync();
        }
    }
}
